<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ГРИНАТОМ | Рапорт</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
            height: 100vh;
            display: flex;
        }
        
        /* Левая панель */
        .left-panel {
            width: 280px;
            background: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e0e0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
            margin-right: 20px;
            border-radius: 10px;
        }
        
        .panel-header {
            padding: 30px 25px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .panel-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 5px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #1a56b6, #2e7d32);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
            color: #2e7d32;
        }
        
        .logo-subtext {
            font-size: 16px;
            color: #1a56b6;
            font-weight: 600;
            margin-left: 55px;
        }
        
        .user-section {
            padding: 25px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .user-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-name i {
            color: #1a56b6;
        }
        
        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #555;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 4px solid transparent;
            font-size: 16px;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: #f8f9fa;
            color: #1a56b6;
        }
        
        .nav-item.active {
            background: #f0f7ff;
            color: #1a56b6;
            border-left-color: #1a56b6;
            font-weight: 600;
        }
        
        .nav-icon {
            width: 24px;
            margin-right: 15px;
            font-size: 18px;
            text-align: center;
        }
        
        .logout-section {
            padding: 25px;
            border-top: 1px solid #e0e0e0;
        }
        
        .logout-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #666;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .logout-btn:hover {
            color: #d32f2f;
        }
        
        .logout-btn i {
            font-size: 18px;
        }
        
        /* Основной контейнер */
        .main-container {
            flex: 1;
            max-width: 1200px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .date-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .date-display {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            padding: 8px 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            min-width: 200px;
        }
        
        .date-input {
            display: none;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-save {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #27ae60;
        }
        
        .btn-end-shift {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-end-shift:hover {
            background-color: #c0392b;
        }
        
        .btn-print {
            background-color: #3498db;
            color: white;
        }
        
        .btn-print:hover {
            background-color: #2980b9;
        }
        
        .divider {
            height: 2px;
            background-color: #3498db;
            margin: 25px 0;
        }
        
        .report-title {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #f8f9fa;
            padding: 8px 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .zoom-btn {
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
        }
        
        .zoom-btn:hover {
            background-color: #d5dbdb;
        }
        
        .zoom-level {
            font-size: 16px;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }
        
        .report-content {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 25px;
            min-height: 400px;
            margin-top: 20px;
            transition: transform 0.3s;
        }
        
        .status-message {
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 500;
            display: none;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        /* Стили для таблицы отчета */
        .report-table-container {
            padding: 0 20px 20px;
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .report-table th {
            background: #f8f9fa;
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border: 1px solid #e0e0e0;
            font-size: 15px;
        }
        
        .report-table td {
            padding: 14px 20px;
            border: 1px solid #e0e0e0;
            vertical-align: top;
            font-size: 14px;
        }
        
        .building-header td {
            background: #f0f7ff;
            font-weight: 600;
            font-size: 16px;
            color: #1a56b6;
            padding: 16px 20px;
        }
        
        .row-number {
            font-weight: 600;
            color: #1a56b6;
            display: inline-block;
            width: 25px;
        }
        
        .data-input {
            width: 100px;
            padding: 8px 10px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            font-weight: 500;
            text-align: center;
        }
        
        .data-input:focus {
            outline: none;
            border-color: #1a56b6;
            box-shadow: 0 0 0 2px rgba(26, 86, 182, 0.1);
        }
        
        .sub-description {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        .separator-line {
            height: 1px;
            background: #e0e0e0;
            margin: 15px 0;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            body, .main-container {
                box-shadow: none;
                padding: 0;
                margin: 0;
            }
            
            .report-content {
                border: none;
                padding: 0;
            }
            
            .left-panel {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Левая панель -->
    <div class="left-panel">
        <div class="panel-header">
            <div class="panel-logo">
                <div class="logo-icon">RA</div>
                <div class="logo-text">ГРИНАТОМ</div>
            </div>
            <div class="logo-subtext">РОСАТОМ</div>
        </div>
        
        <div class="user-section">
            <div class="user-name">
                <i class="fas fa-user-circle"></i>
                <span id="currentUser">Иван Иванов</span>
            </div>
        </div>
        
        <div class="nav-menu">
            <div class="nav-item active" onclick="showMainPage()">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <span>Главная страница</span>
            </div>
            <div class="nav-item" onclick="showReports()">
                <div class="nav-icon"><i class="fas fa-file-alt"></i></div>
                <span>Рапорты</span>
            </div>
            <div class="nav-item" onclick="showDocuments()">
                <div class="nav-icon"><i class="fas fa-chart-bar"></i></div>
                <span>Отчеты</span>
            </div>
        </div>
        
        <div class="logout-section">
            <div class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Выйти</span>
            </div>
        </div>
    </div>

    <!-- Основной контейнер -->
    <div class="main-container">
        <div class="header">
            <div class="date-section">
                <div class="date-display" id="dateDisplay">Загрузка даты...</div>
                <button class="btn btn-save no-print" id="saveBtn">
                    <i class="fas fa-save"></i> Сохранить
                </button>
            </div>
            <button class="btn btn-end-shift no-print" id="endShiftBtn">
                <i class="fas fa-flag-checkered"></i> Завершить смену
            </button>
        </div>
        
        <div class="divider"></div>
        
        <div class="report-title">
            <span id="reportTitle">Загрузка...</span>
            <div class="controls no-print">
                <div class="zoom-controls">
                    <button class="zoom-btn" id="zoomOutBtn">-</button>
                    <span class="zoom-level" id="zoomLevel">100%</span>
                    <button class="zoom-btn" id="zoomInBtn">+</button>
                </div>
                <button class="btn btn-print" id="printBtn">
                    <i class="fas fa-print"></i> Печать
                </button>
            </div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
        
        <div class="report-content" id="reportContent">
            <div class="report-table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th width="70%">Наименование отчетной позиции</th>
                            <th width="30%">1-я смена «7:00–15:00»</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Здание 1 -->
                        <tr class="building-header">
                            <td colspan="2">Здание 1</td>
                        </tr>
                        
                        <tr>
                            <td>
                                <span class="row-number">1</span>
                                Количество принятых и переработанных методом аммиачного осаждения растворов
                                <div class="sub-description">за смену, м³</div>
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px; justify-content: center;">
                                    <input type="text" class="data-input" id="data1-1">
                                </div>
                            </td>
                        </tr>
                        
                        <tr>
                            <td>
                                <span class="row-number">2</span>
                                Количество прокаленной пульпы
                                <div class="sub-description">за смену, м³</div>
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px; justify-content: center;">
                                    <input type="text" class="data-input" id="data2-1">
                                </div>
                            </td>
                        </tr>
                        
                        <tr><td colspan="2"><div class="separator-line"></div></td></tr>
                        
                        <!-- Здание 2 -->
                        <tr class="building-header">
                            <td colspan="2">Здание 2</td>
                        </tr>
                        
                        <tr>
                            <td>
                                <span class="row-number">3</span>
                                Количество принятых и переработанных методом известкования растворов за смену, м³
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px; justify-content: center;">
                                    <input type="text" class="data-input" id="data3-1">
                                </div>
                            </td>
                        </tr>
                        
                        <tr>
                            <td>
                                <span class="row-number">4</span>
                                Отфильтровано пульпы за смену, м³
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px; justify-content: center;">
                                    <input type="text" class="data-input" id="data4-1">
                                </div>
                            </td>
                        </tr>
                        
                        <tr>
                            <td>
                                <span class="row-number">5</span>
                                Получено контейнеров за смену, шт.
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px; justify-content: center;">
                                    <input type="text" class="data-input" id="data5-1">
                                </div>
                            </td>
                        </tr>
                        
                        <tr><td colspan="2"><div class="separator-line"></div></td></tr>
                        
                        <!-- Здание 3 -->
                        <tr class="building-header">
                            <td colspan="2">Здание 3</td>
                        </tr>
                        
                        <tr>
                            <td>
                                <span class="row-number">6</span>
                                Сжигание отходов
                                <div class="sub-description">— переработано отходов за смену, кг</div>
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px; justify-content: center;">
                                    <input type="text" class="data-input" id="data6-1">
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Элементы DOM
        const dateDisplay = document.getElementById('dateDisplay');
        const saveBtn = document.getElementById('saveBtn');
        const endShiftBtn = document.getElementById('endShiftBtn');
        const reportTitle = document.getElementById('reportTitle');
        const zoomOutBtn = document.getElementById('zoomOutBtn');
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomLevel = document.getElementById('zoomLevel');
        const printBtn = document.getElementById('printBtn');
        const reportContent = document.getElementById('reportContent');
        const statusMessage = document.getElementById('statusMessage');
        
        // Элементы для данных отчета
        const currentUser = document.getElementById('currentUser');
        
        // Текущая дата из системы компьютера
        let currentDate = new Date();
        
        // Форматирование даты
        function formatDate(date) {
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return date.toLocaleDateString('ru-RU', options);
        }
        
        // Форматирование даты для ключа в localStorage
        function formatDateKey(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Обновление отображения даты
        function updateDateDisplay() {
            const formattedDate = formatDate(currentDate);
            dateDisplay.textContent = formattedDate;
            reportTitle.textContent = `Рапорт за ${formattedDate}`;
        }
        
        // Получение текущей даты из системы
        function getCurrentSystemDate() {
            return new Date();
        }
        
        // Сохранение отчета
        function saveDate() {
            updateDateDisplay();
            
            // Сбор данных отчета
            const reportData = collectReportData();
            const dateKey = formatDateKey(currentDate);
            localStorage.setItem(`report_${dateKey}`, JSON.stringify(reportData));
            
            // Показываем сообщение об успехе
            statusMessage.textContent = `Отчет за ${formatDate(currentDate)} сохранен!`;
            statusMessage.className = 'status-message success-message';
            statusMessage.style.display = 'block';
            
            // Скрываем сообщение через 3 секунды
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
            
            console.log('Отчет сохранен:', reportData);
        }
        
        // Сбор данных отчета
        function collectReportData() {
            return {
                date: formatDateKey(currentDate),
                building1: {
                    item1: { 
                        shift: document.getElementById('data1-1').value, 
                        month: document.getElementById('data1-2').value 
                    },
                    item2: { 
                        shift: document.getElementById('data2-1').value, 
                        month: document.getElementById('data2-2').value 
                    }
                },
                building2: {
                    item3: { 
                        shift: document.getElementById('data3-1').value, 
                        month: document.getElementById('data3-2').value 
                    },
                    item4: { 
                        shift: document.getElementById('data4-1').value, 
                        month: document.getElementById('data4-2').value 
                    },
                    item5: { 
                        shift: document.getElementById('data5-1').value, 
                        month: document.getElementById('data5-2').value 
                    }
                },
                building3: {
                    item6: { 
                        shift: document.getElementById('data6-1').value, 
                        campaign: document.getElementById('data6-2').value 
                    }
                },
                timestamp: new Date().toISOString(),
                operator: currentUser.textContent
            };
        }
        
        // Завершение смены
        function endShift() {
            if (confirm('Вы уверены, что хотите завершить смену? После завершения редактирование будет невозможно.')) {
                // Сохраняем отчет перед завершением
                saveDate();
                
                statusMessage.textContent = 'Смена завершена успешно! Отчет отправлен в архив.';
                statusMessage.className = 'status-message success-message';
                statusMessage.style.display = 'block';
                
                // Блокируем элементы редактирования
                document.querySelectorAll('.data-input').forEach(input => {
                    input.disabled = true;
                });
                saveBtn.disabled = true;
                endShiftBtn.disabled = true;
                
                console.log('Смена завершена');
                
                // Скрываем сообщение через 3 секунды
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 3000);
            }
        }
        
        // Управление масштабом
        let currentZoom = 100;
        
        function updateZoom() {
            zoomLevel.textContent = `${currentZoom}%`;
            reportContent.style.transform = `scale(${currentZoom / 100})`;
            reportContent.style.transformOrigin = 'top left';
        }
        
        function zoomIn() {
            if (currentZoom < 150) {
                currentZoom += 10;
                updateZoom();
            }
        }
        
        function zoomOut() {
            if (currentZoom > 50) {
                currentZoom -= 10;
                updateZoom();
            }
        }
        
        // Печать
        function printReport() {
            window.print();
        }
        
        // Инициализация
        function init() {
            // Установка имени пользователя
            const username = localStorage.getItem('username') || 'Иван Иванов';
            currentUser.textContent = username;
            
            // Устанавливаем текущую дату из системы
            currentDate = getCurrentSystemDate();
            updateDateDisplay();
            
            // Загрузка сохраненного отчета
            loadSavedReport();
            
            // Обработчики событий
            saveBtn.addEventListener('click', saveDate);
            endShiftBtn.addEventListener('click', endShift);
            zoomInBtn.addEventListener('click', zoomIn);
            zoomOutBtn.addEventListener('click', zoomOut);
            printBtn.addEventListener('click', printReport);
            
            // Обработка горячих клавиш
            document.addEventListener('keydown', (e) => {
                // Ctrl + S для сохранения
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveDate();
                }
                
                // Ctrl + P для печати
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    printReport();
                }
                
                // Ctrl + '+' для увеличения масштаба
                if (e.ctrlKey && (e.key === '+' || e.key === '=')) {
                    e.preventDefault();
                    zoomIn();
                }
                
                // Ctrl + '-' для уменьшения масштаба
                if (e.ctrlKey && e.key === '-') {
                    e.preventDefault();
                    zoomOut();
                }
            });
        }
        
        // Загрузка сохраненного отчета
        function loadSavedReport() {
            const dateKey = formatDateKey(currentDate);
            const savedReport = localStorage.getItem(`report_${dateKey}`);
            
            if (savedReport) {
                try {
                    const reportData = JSON.parse(savedReport);
                    
                    // Загружаем данные только если они существуют в сохраненном отчете
                    if (reportData.building1) {
                        if (reportData.building1.item1) {
                            document.getElementById('data1-1').value = reportData.building1.item1.shift || '';
                            document.getElementById('data1-2').value = reportData.building1.item1.month || '';
                        }
                        if (reportData.building1.item2) {
                            document.getElementById('data2-1').value = reportData.building1.item2.shift || '';
                            document.getElementById('data2-2').value = reportData.building1.item2.month || '';
                        }
                    }
                    
                    if (reportData.building2) {
                        if (reportData.building2.item3) {
                            document.getElementById('data3-1').value = reportData.building2.item3.shift || '';
                            document.getElementById('data3-2').value = reportData.building2.item3.month || '';
                        }
                        if (reportData.building2.item4) {
                            document.getElementById('data4-1').value = reportData.building2.item4.shift || '';
                            document.getElementById('data4-2').value = reportData.building2.item4.month || '';
                        }
                        if (reportData.building2.item5) {
                            document.getElementById('data5-1').value = reportData.building2.item5.shift || '';
                            document.getElementById('data5-2').value = reportData.building2.item5.month || '';
                        }
                    }
                    
                    if (reportData.building3 && reportData.building3.item6) {
                        document.getElementById('data6-1').value = reportData.building3.item6.shift || '';
                        document.getElementById('data6-2').value = reportData.building3.item6.campaign || '';
                    }
                    
                    console.log('Отчет загружен:', dateKey);
                } catch (e) {
                    console.error('Ошибка загрузки отчета:', e);
                }
            }
        }
        
        // Выход из системы
        function logout() {
            localStorage.removeItem('username');
            window.location.href = 'index.html';
        }
        
        // Навигация
        function showMainPage() {
            alert('Вы находитесь на главной странице');
        }
        
        function showReports() {
            alert('Раздел "Рапорты" находится в разработке');
        }
        
        function showDocuments() {
            alert('Раздел "Отчеты" находится в разработке');
        }
        
        // Запуск при загрузке страницы
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>